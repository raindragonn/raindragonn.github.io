---
layout: "post"
title: "웹 기본 지식 - HTTP 메서드"
subtitle: "웹 기본 지식 - HTTP 메서드"
date: 2023-08-17
author: "raindragonn"
lang: ko
categories: [CS]
tags:
  - CS
  - HTTP Methods
---

## HTTP API를 만들어보자

### 요구사항

- 회원정보 관리 API를 만들어야한다.
    - 회원 목록 조회
    - 회원 조회
    - 회원 등록
    - 회원 수정
    - 회원 삭제

### 1. API URI 설계

- 회원 목록 조회 /read-member-list
- 회원 조회 /read-member-by-id
- 회원 등록 /create-member
- 회원 수정 /update-member
- 회원 삭제 /delete-member

### URI 설계의 중요한 점은 리소스 식별이다.

- 리소스의 의미
    - 회원을 등록, 수정, 조회하는게 리소스가 아니다.
    - **회원이라는 개념 자체가 바로 리소스다.**
- 리소스를 식별하는 방법
    - 회원을 등록하고 수정하고 조회하는 것을 모두 배제
    - **회원이라는 리소스만 식별하면 된다.**
        - **회원 리소스를 URI에 매핑한다.**

### 2. API URI 설계 개선

- **회원** 목록 조회 /members
- **회원** 조회 /members/{id}
- **회원** 등록 /members/{id}
- **회원** 수정 /members/{id}
- **회원** 삭제 /members/{id}
- **위와 같이 설계를 하는 경우 조회, 등록, 수정, 삭제를 어떻게 구분하는가에 대한 문제가 생긴다.**

### 리소스와 행위를 분리

- **URI는 “리소스만” 식별**
- **리소스**와 해당 리소스를 대상으로 하는 **행위**를 분리
    - 리소스 - 회원
    - 행위 - 조회, 등록, 삭제, 변경
- 보통 리소스는 명사, 행위는 동사로 나타낸다.

## GET, POST

### HTTP의 주요 메서드 종류

- GET: 리소스 조회
- POST: 요청 데이터 처리, 주로 등록에 사용
    - 데이터에 대한 처리를 요청
- PUT: 리소스를 대체, 해당 리소스가 없으면 생성
    - 파일을 폴더에 넣는것으로 비유 (덮어쓰기)
- PATCH: 리소스 부분 변경
- DELETE: 리소스 삭제

### HTTP의 기타 메서드 종류

- **HEAD:** GET과 동일하지만 메시지 부분을 제외하고, 상태 줄과 헤더만 반환
- **OPTIONS:** 대상 리소스에 대한 통신 가능 옵션(메서드)을 설명(주로 CORS에서 사용)
- **CONNECT:** 대상 리소스로 식별되는 서버에 대한 터널을 설정
- **TRACE:** 대상 리소스에 대한 경로를 따라 메시지 루프백 테스트를 수행

### GET

- 리소스를 조회한다.
- 서버에 전달하고 싶은 데이터는 query(쿼리파라미터, 쿼리 스트링)를 통해서 전달한다.
- 메시지 바디를 사용해서 데이터를 전달할 수 있지만, 지원하지 않는 곳이 많아서 권장하지 않음.

### POST

- 요청 데이터를 처리한다.
- **메시지 바디를 통해 서버로 요청 데이터를 전달한다.**
    - 서버는 요청 데이터를 처리
    - 메시지 바디를 통해 들어온 데이터를 **처리**하는 모든 기능을 수행
- 주로 전달된 데이터로 신규 리소스 등록, 프로세스 처리에 사용한다.

### POST는 데이터를 어떻게 처리한다는 뜻일까?

- 스펙: POST 메서드는 **대상 리소스가 리소스의 고유 한 의미 체계에 따라 요청에 포함 된 표현을 처리하도록 요청**합니다. (구글 번역)
- **정리: 이 리소스 URI에 POST요청이 오면 요청 데이터를 어떻게 처리할지 리소스마다 따로 정해야 한다.**
    - 정해진 것이 없음.
    - 즉, 클라이언트와 해당 요청에 대한 데이터 처리방식을 정할 수 있다.
- 예시
    - 게시판 글쓰기,댓글 달기
    - 신규 주문 생성
    - 한 문서 끝에 내용 추가
    - HTML FORM에 입력한 정보로 회원 가입, 주문 등에서 사용

### POST메서드의 일반적 데이터 처리 예시

1. **새 리소스 생성(등록)**
    - 서버가 아직 식별하지 않은 새 리소스 생성
        - ex) 회원가입
2. **요청 데이터 처리**
    - 단순히 데이터를 생성하거나, 변경하는 것을 넘어서 프로세스를 처리해야 하는 경우
        - ex)주문에서 결제완료->배달시작->배달완료 처럼 단순히 값 변경을 넘어 프로세스의 상태가 변경되는 경우
        - POST /orders/{orderId}/start-delivery (**컨트롤 URI**)
3. **다른 메서드로 처리하기 애매한 경우**
    - JSON으로 조회 데이터를 넘겨야 할 때, GET 메서드를 사용하기 어려운 경우

## PUT, PATCH, DELETE

### PUT

- **리소스를 대체한다.**
    - 리소스를 덮어버린다. (있으면 대체, 없으면 생성)
- **클라이언트가 리소스를 식별한다.**
    - 클라이언트가 리소스 위치를 알고 URI 지정
        - POST와의 차이점
        - ex) PUT members/100 → 회원 목록의 100번의 리소스를 알고 있음.
- **리소스를 완전히 대체하기에 발생할 수 있는 문제 상황**
    - 요청 데이터에 문제가 있는 경우
        - ex) userName, age 필드의 데이터가 필요하지만 age만 보내는 경우

### PATCH

- **리소스 부분 변경한다.**
    - ex) userName, age 필드 중 age만 변경하고 싶다.
- PATCH를 지원하지않는 경우 POST를 사용한다.

### DELETE

- **리소스를 제거한다.**

## HTTP 메서드의 속성

![https://ko.wikipedia.org/wiki/HTTP](/assets/images/post/2023-08-17-http-methods/1.png)

https://ko.wikipedia.org/wiki/HTTP

### 안전(Safe Methods)

- 호출해도 리소스를 변경하지 않는다.
    - 안전은 해당 리소스만 고려한다.(로그가 쌓여 장애 발생 같은 상황 X)
- GET, HEAD 등

### 멱등(Idenpotnet Methods)

- f(f(x)) = f(x)
- 한번 호출하나 100번 호출하나 결과가 같다.
- 멱등 메서드
    - GET, PUT, DELETE
    - **몇번을 요청해도 결과가 같다. (멱등하다.)**
    - **멱등은 외부 요인으로 중간에 리소스가 변경되는 것 까지는 고려하지 않는다.**
        - GET으로 특정 회원을 연속해서 조회 중 다른 사용자가 PUT으로 결과를 바꾼 경우
    - **POST는 멱등이 아니다.**
        - 두 번 호출하면 같은 결제가 중복해서 발생할 수 있다.
    - 활용
        - 자동 복구 매커니즘
        - 서버에 문제가 발생하여 정상적으로 응답하지 않은 경우, 클라이언트가 같은 요청을 다시 해도 괜찮은가를 판단하는 근거

### 캐시가능(Cacheable Methods)

- 응답 결과 리소스를 캐시해서 사용해도 되는지 여부를 나타낸다.
- 캐시가능 메서드
    - GET, HEAD, POST, PATCH
- 실제로는 GET, HEAD 정도만 캐시로 사용한다.
    - POST, PATCH는 본문 내용까지 캐시 키로 고려해야 하는데, 구현이 쉽지 않음
    - 보통 키에 따른 캐시를 구분